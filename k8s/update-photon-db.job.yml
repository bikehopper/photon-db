apiVersion: batch/v1
kind: CronJob
metadata:
  name: update-photon-db
spec:
  schedule: "*/15 * * * *"
  successfulJobsHistoryLimit: 0
  failedJobsHistoryLimit: 1
  concurrencyPolicy: Replace
  jobTemplate:
    spec:
      backoffLimit: 1
      template:
        spec:
          restartPolicy: Never
          containers:
          - name: updater-photon-db
            image: alpine/curl:3.14
            command: ["curl"]
            args: ["http://$(PHOTON_SVC_NAME).$(POD_NAMESPACE)/nominatim-update", "--silent"]
            resources:
              requests:
                memory: "10Mi"
                cpu: "50m"
            env:
            - name: PHOTON_SVC_NAME
              value: photon-db-svc
            - name: POD_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace

